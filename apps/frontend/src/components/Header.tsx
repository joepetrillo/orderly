import { useEffect, useState } from "react";
import { Dialog } from "@headlessui/react";
import { Bars3Icon, XMarkIcon } from "@heroicons/react/24/outline";
import { SignedIn, SignedOut, UserButton } from "@clerk/nextjs";
import Link from "next/link";
import { useRouter } from "next/router";
import Button from "@/components/ui/Button";

export default function Header() {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const router = useRouter();

  useEffect(() => {
    setMobileMenuOpen(false);
  }, [router.pathname]);

  return (
    <header className="z-10">
      <nav className="mx-auto flex h-24 max-w-7xl items-center justify-between p-6 text-gray-950 lg:px-8">
        <div className="flex lg:flex-1">
          <Link href="/" className="-m-1.5 p-1.5">
            <svg
              width="124"
              height="31"
              viewBox="0 0 124 31"
              fill="#030712"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M0.628906 15.0821C0.628912 24.5946 6.55361 30.4534 17.5143 30.2229C8.51148 26.1931 8.34571 4.71575 17.5143 0.829863C8.23608 0.138336 0.628901 5.56951 0.628906 15.0821Z" />
              <path d="M17.168 4.04097C22.2949 12.0559 22.4004 17.0144 17.168 26.7852C22.6319 31.8541 31.1897 26.1269 31.1897 15.0016C31.1897 3.87625 21.8419 -0.303801 17.168 4.04097Z" />
              <path d="M52.0204 23.2261C50.9004 23.2261 49.8784 23.0371 48.9544 22.6591C48.0304 22.2811 47.2254 21.7491 46.5394 21.0631C45.8534 20.3771 45.3214 19.5721 44.9434 18.6481C44.5654 17.7241 44.3764 16.7091 44.3764 15.6031C44.3764 14.4971 44.5654 13.4821 44.9434 12.5581C45.3214 11.6341 45.8534 10.8291 46.5394 10.1431C47.2254 9.45711 48.0304 8.92511 48.9544 8.54711C49.8784 8.16911 50.8934 7.98011 51.9994 7.98011C53.1054 7.98011 54.1204 8.16911 55.0444 8.54711C55.9684 8.92511 56.7734 9.45711 57.4594 10.1431C58.1454 10.8291 58.6704 11.6341 59.0344 12.5581C59.4124 13.4821 59.6014 14.4971 59.6014 15.6031C59.6014 16.6951 59.4124 17.7101 59.0344 18.6481C58.6704 19.5721 58.1454 20.3771 57.4594 21.0631C56.7734 21.7491 55.9684 22.2811 55.0444 22.6591C54.1204 23.0371 53.1124 23.2261 52.0204 23.2261ZM51.9994 19.8661C52.5734 19.8661 53.0984 19.7611 53.5744 19.5511C54.0644 19.3411 54.4844 19.0471 54.8344 18.6691C55.1984 18.2771 55.4784 17.8221 55.6744 17.3041C55.8704 16.7861 55.9684 16.2191 55.9684 15.6031C55.9684 14.9871 55.8704 14.4201 55.6744 13.9021C55.4784 13.3841 55.1984 12.9361 54.8344 12.5581C54.4844 12.1661 54.0644 11.8651 53.5744 11.6551C53.0984 11.4451 52.5734 11.3401 51.9994 11.3401C51.4254 11.3401 50.8934 11.4451 50.4034 11.6551C49.9274 11.8651 49.5074 12.1661 49.1434 12.5581C48.7794 12.9361 48.4994 13.3841 48.3034 13.9021C48.1214 14.4201 48.0304 14.9871 48.0304 15.6031C48.0304 16.2191 48.1214 16.7931 48.3034 17.3251C48.4994 17.8431 48.7794 18.2911 49.1434 18.6691C49.5074 19.0471 49.9274 19.3411 50.4034 19.5511C50.8934 19.7611 51.4254 19.8661 51.9994 19.8661ZM61.7964 23.0161V11.8651H64.9884L65.1354 15.4981L64.5054 14.8051C64.6734 14.2031 64.9464 13.6641 65.3244 13.1881C65.7164 12.7121 66.1714 12.3341 66.6894 12.0541C67.2074 11.7741 67.7604 11.6341 68.3484 11.6341C68.6004 11.6341 68.8314 11.6551 69.0414 11.6971C69.2654 11.7391 69.4684 11.7881 69.6504 11.8441L68.7264 15.5611C68.5724 15.4631 68.3624 15.3861 68.0964 15.3301C67.8444 15.2601 67.5784 15.2251 67.2984 15.2251C66.9904 15.2251 66.7034 15.2811 66.4374 15.3931C66.1714 15.4911 65.9474 15.6381 65.7654 15.8341C65.5834 16.0301 65.4364 16.2611 65.3244 16.5271C65.2264 16.7931 65.1774 17.0941 65.1774 17.4301V23.0161H61.7964ZM74.8923 23.2471C73.9263 23.2471 73.0653 23.0021 72.3093 22.5121C71.5673 22.0081 70.9793 21.3221 70.5453 20.4541C70.1113 19.5721 69.8943 18.5711 69.8943 17.4511C69.8943 16.3311 70.1113 15.3371 70.5453 14.4691C70.9793 13.5871 71.5743 12.8941 72.3303 12.3901C73.0863 11.8861 73.9543 11.6341 74.9343 11.6341C75.4383 11.6341 75.9213 11.7111 76.3833 11.8651C76.8453 12.0191 77.2653 12.2291 77.6433 12.4951C78.0213 12.7611 78.3293 13.0691 78.5673 13.4191C78.8053 13.7551 78.9453 14.1051 78.9873 14.4691L78.1893 14.6581V7.47611H81.5703V23.0161H78.4413L78.2523 20.4751L78.9243 20.5801C78.8823 20.9301 78.7423 21.2661 78.5043 21.5881C78.2803 21.9101 77.9863 22.1971 77.6223 22.4491C77.2583 22.6871 76.8383 22.8761 76.3623 23.0161C75.9003 23.1701 75.4103 23.2471 74.8923 23.2471ZM75.7533 20.4541C76.2713 20.4541 76.7193 20.3281 77.0973 20.0761C77.4753 19.8241 77.7623 19.4741 77.9583 19.0261C78.1683 18.5781 78.2733 18.0531 78.2733 17.4511C78.2733 16.8351 78.1683 16.3031 77.9583 15.8551C77.7623 15.4071 77.4753 15.0571 77.0973 14.8051C76.7193 14.5531 76.2713 14.4271 75.7533 14.4271C75.2353 14.4271 74.7873 14.5531 74.4093 14.8051C74.0453 15.0571 73.7583 15.4071 73.5483 15.8551C73.3383 16.3031 73.2333 16.8351 73.2333 17.4511C73.2333 18.0531 73.3383 18.5781 73.5483 19.0261C73.7583 19.4741 74.0453 19.8241 74.4093 20.0761C74.7873 20.3281 75.2353 20.4541 75.7533 20.4541ZM89.5146 23.2261C88.2826 23.2261 87.2116 22.9811 86.3016 22.4911C85.3916 21.9871 84.6846 21.3081 84.1806 20.4541C83.6766 19.5861 83.4246 18.5991 83.4246 17.4931C83.4246 16.6391 83.5646 15.8551 83.8446 15.1411C84.1246 14.4271 84.5166 13.8111 85.0206 13.2931C85.5246 12.7611 86.1196 12.3551 86.8056 12.0751C87.5056 11.7811 88.2686 11.6341 89.0946 11.6341C89.8786 11.6341 90.5926 11.7741 91.2366 12.0541C91.8946 12.3341 92.4616 12.7261 92.9376 13.2301C93.4136 13.7341 93.7776 14.3291 94.0296 15.0151C94.2816 15.7011 94.3936 16.4501 94.3656 17.2621L94.3446 18.1651H85.4616L84.9786 16.2751H91.6146L91.2576 16.6741V16.2541C91.2296 15.9041 91.1176 15.5961 90.9216 15.3301C90.7396 15.0501 90.4946 14.8331 90.1866 14.6791C89.8786 14.5251 89.5286 14.4481 89.1366 14.4481C88.5906 14.4481 88.1216 14.5601 87.7296 14.7841C87.3516 14.9941 87.0646 15.3091 86.8686 15.7291C86.6726 16.1351 86.5746 16.6391 86.5746 17.2411C86.5746 17.8571 86.7006 18.3961 86.9526 18.8581C87.2186 19.3061 87.5966 19.6561 88.0866 19.9081C88.5906 20.1601 89.1856 20.2861 89.8716 20.2861C90.3476 20.2861 90.7676 20.2161 91.1316 20.0761C91.5096 19.9361 91.9156 19.6981 92.3496 19.3621L93.9246 21.5881C93.4906 21.9661 93.0286 22.2741 92.5386 22.5121C92.0486 22.7501 91.5446 22.9251 91.0266 23.0371C90.5226 23.1631 90.0186 23.2261 89.5146 23.2261ZM96.2963 23.0161V11.8651H99.4883L99.6353 15.4981L99.0053 14.8051C99.1733 14.2031 99.4463 13.6641 99.8243 13.1881C100.216 12.7121 100.671 12.3341 101.189 12.0541C101.707 11.7741 102.26 11.6341 102.848 11.6341C103.1 11.6341 103.331 11.6551 103.541 11.6971C103.765 11.7391 103.968 11.7881 104.15 11.8441L103.226 15.5611C103.072 15.4631 102.862 15.3861 102.596 15.3301C102.344 15.2601 102.078 15.2251 101.798 15.2251C101.49 15.2251 101.203 15.2811 100.937 15.3931C100.671 15.4911 100.447 15.6381 100.265 15.8341C100.083 16.0301 99.9363 16.2611 99.8243 16.5271C99.7263 16.7931 99.6773 17.0941 99.6773 17.4301V23.0161H96.2963Z" />
              <path d="M105.664 23.0161V7.47611H109.024V23.0161H105.664ZM112.91 27.8461L115.451 21.8611L115.493 23.5831L110.117 11.8651H113.918L116.27 17.4721C116.396 17.7521 116.515 18.0531 116.627 18.3751C116.739 18.6971 116.823 19.0051 116.879 19.2991L116.417 19.5721C116.501 19.3621 116.592 19.1031 116.69 18.7951C116.802 18.4731 116.921 18.1301 117.047 17.7661L119.105 11.8651H122.927L118.181 23.0161L116.249 27.8461H112.91Z" />
            </svg>
            {/* <span className="sr-only">Orderly</span>
            <span className="font-semibold leading-6">Orderly</span> */}
          </Link>
        </div>
        <SignedOut>
          <Button as="link" variant="outline" href="/signin" size="lg">
            Sign in
          </Button>
        </SignedOut>
        <SignedIn>
          <div className="flex lg:hidden">
            <button
              type="button"
              className="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5"
              onClick={() => setMobileMenuOpen(true)}
            >
              <span className="sr-only">Open main menu</span>
              <Bars3Icon className="h-6 w-6" aria-hidden="true" />
            </button>
          </div>
          <div className="hidden text-sm font-semibold leading-6 lg:flex lg:gap-x-12">
            <Link href="/dashboard">Dashboard</Link>
            <Link href="/upcoming">Upcoming</Link>
            <Link href="/prof">Professor View</Link>
          </div>
          <div className="hidden lg:flex lg:flex-1 lg:justify-end">
            <UserButton
              appearance={{
                elements: {
                  userButtonAvatarBox: "h-11 w-11",
                },
                variables: {
                  colorPrimary: "#4E46E5",
                  colorText: "#030712",
                  colorTextOnPrimaryBackground: "#F9FAFB",
                },
              }}
              userProfileMode="navigation"
              userProfileUrl="/account"
              afterSignOutUrl="/"
            />
          </div>
        </SignedIn>
      </nav>

      <SignedIn>
        <Dialog
          as="div"
          className="text-gray-950 lg:hidden"
          open={mobileMenuOpen}
          onClose={setMobileMenuOpen}
        >
          <div className="fixed inset-0 z-10" />
          <Dialog.Panel className="fixed inset-y-0 right-0 z-10 w-full overflow-y-auto bg-white p-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10">
            <div className="flex h-12 items-center justify-between">
              <Link href="/" className="-m-1.5 p-1.5">
                <span className="sr-only">Orderly</span>
                <span className="font-semibold leading-6">Orderly</span>
              </Link>
              <button
                type="button"
                className="-m-2.5 rounded-md p-2.5"
                onClick={() => setMobileMenuOpen(false)}
              >
                <span className="sr-only">Close menu</span>
                <XMarkIcon className="h-6 w-6" aria-hidden="true" />
              </button>
            </div>
            <div className="mt-6 flow-root">
              <div className="-my-6 divide-y divide-gray-500/10">
                <div className="space-y-2 py-6 font-semibold leading-7">
                  <Link
                    href="/dashboard"
                    className="-mx-3 block rounded-lg px-3 py-2 hover:bg-gray-50"
                  >
                    Dashboard
                  </Link>
                  <Link
                    href="/upcoming"
                    className="-mx-3 block rounded-lg px-3 py-2 hover:bg-gray-50"
                  >
                    Upcoming
                  </Link>

                  <Link
                    href="/prof"
                    className="-mx-3 block rounded-lg px-3 py-2 hover:bg-gray-50"
                  >
                    ProfessorView
                  </Link>
                </div>
                <div className="py-6">
                  <UserButton
                    appearance={{
                      elements: {
                        userButtonAvatarBox: "h-11 w-11",
                      },
                      variables: {
                        colorPrimary: "#4E46E5",
                        colorText: "#030712",
                        colorTextOnPrimaryBackground: "#F9FAFB",
                      },
                    }}
                    userProfileMode="navigation"
                    userProfileUrl="/account"
                    afterSignOutUrl="/"
                  />
                </div>
              </div>
            </div>
          </Dialog.Panel>
        </Dialog>
      </SignedIn>
    </header>
  );
}
